# åŠ¨æ€æ–°é—»æ£€æŸ¥ç‚¹åŠŸèƒ½å®ç°è¯´æ˜

## âœ… å·²å®ç°çš„åŠŸèƒ½

### 1. æ‰©å±• CheckpointManager

**æ–°å¢å­—æ®µæ”¯æŒ**ï¼š
- `seen_article_ids`: å·²çˆ¬å–çš„æ–‡ç« IDåˆ—è¡¨
- `min_article_id`: å·²çˆ¬å–çš„æœ€å°æ–‡ç« IDï¼ˆç”¨äºå€’åºæ’åˆ—ï¼‰
- `max_article_id`: å·²çˆ¬å–çš„æœ€å¤§æ–‡ç« IDï¼ˆç”¨äºæ­£åºæ’åˆ—ï¼‰

**æ–°å¢æ–¹æ³•**ï¼š
- `get_seen_article_ids()`: è·å–å·²çˆ¬å–çš„æ–‡ç« IDé›†åˆ
- `get_min_article_id()`: è·å–æœ€å°æ–‡ç« ID
- `get_max_article_id()`: è·å–æœ€å¤§æ–‡ç« ID

### 2. DynamicNewsCrawler é›†æˆæ£€æŸ¥ç‚¹

**ä¿®æ”¹çš„æ–¹æ³•**ï¼š
- `crawl_dynamic_page_ajax()`: æ·»åŠ æ£€æŸ¥ç‚¹æ”¯æŒ

**æ–°å¢å‚æ•°**ï¼š
- `resume`: æ˜¯å¦ä»æ£€æŸ¥ç‚¹æ¢å¤ï¼ˆé»˜è®¤Trueï¼‰
- `start_page`: èµ·å§‹é¡µç ï¼ˆè¦†ç›–æ£€æŸ¥ç‚¹ï¼‰

**æ ¸å¿ƒé€»è¾‘**ï¼š
1. åˆ›å»ºæ£€æŸ¥ç‚¹ç®¡ç†å™¨
2. ä»æ£€æŸ¥ç‚¹æ¢å¤ `seen_article_ids`ã€`min_article_id`ã€`max_article_id`
3. åŸºäº `article_id` å»é‡ï¼ˆåŒé‡ä¿éšœï¼‰
4. æ¯é¡µä¿å­˜æ£€æŸ¥ç‚¹
5. ä»»åŠ¡å®Œæˆæ—¶æ ‡è®°

### 3. CLI å‘½ä»¤æ”¯æŒ

**æ–°å¢å‚æ•°**ï¼š
- `--resume` / `--no-resume`: æ§åˆ¶æ˜¯å¦ä»æ£€æŸ¥ç‚¹æ¢å¤
- `--start-page`: æ‰‹åŠ¨æŒ‡å®šèµ·å§‹é¡µ

---

## ğŸ” å·¥ä½œåŸç†è¯¦è§£

### æ£€æŸ¥ç‚¹æ•°æ®ç»“æ„ï¼ˆåŠ¨æ€æ–°é—»ï¼‰

```json
{
  "site": "sxd.xd.com",
  "board": "news",
  "current_page": 6,
  "last_thread_id": "15450",
  "status": "running",
  "seen_article_ids": [           // ğŸ†• å·²çˆ¬å–çš„æ–‡ç« IDåˆ—è¡¨
    "15503", "15502", "15501", "15470", "15469", "15450"
  ],
  "min_article_id": "15450",       // ğŸ†• æœ€å°IDï¼ˆå€’åºæ’åˆ—çš„å…³é”®ï¼‰
  "max_article_id": "15503",       // ğŸ†• æœ€å¤§IDï¼ˆæ­£åºæ’åˆ—çš„å…³é”®ï¼‰
  "stats": {
    "articles_found": 25,
    "images_downloaded": 50
  }
}
```

### å»é‡é€»è¾‘ï¼ˆä¸‰é‡ä¿éšœ + æ–°æ–‡ç« æ£€æµ‹ï¼‰

#### æ–¹å¼1: é›†åˆå»é‡ï¼ˆç²¾ç¡®ï¼‰

```python
# é€šè¿‡ seen_article_ids é›†åˆç²¾ç¡®å»é‡
if article_id in seen_article_ids:
    logger.debug(f"â­ï¸  è·³è¿‡å·²çˆ¬å–æ–‡ç« : {article_id} (åœ¨é›†åˆä¸­)")
    continue
```

**ä¼˜ç‚¹**ï¼š
- âœ… ç²¾ç¡®ï¼Œä¸ä¼šé—æ¼
- âœ… é€‚ç”¨äºä»»ä½•ç±»å‹çš„ article_id

**ç¼ºç‚¹**ï¼š
- âš ï¸ å¦‚æœæ–‡ç« æ•°é‡å¾ˆå¤§ï¼Œé›†åˆä¼šå¾ˆå¤§

#### æ–¹å¼2: IDèŒƒå›´åˆ¤æ–­ï¼ˆå¿«é€Ÿ + æ–°æ–‡ç« æ£€æµ‹ï¼‰

```python
# æƒ…å†µ1: æ–°æ–‡ç« ï¼ˆID > max_article_idï¼‰- ç½‘ç«™æœ‰æ›´æ–°ï¼Œåº”è¯¥çˆ¬å–
if article_id_int > max_id_int:
    logger.info(f"ğŸ†• å‘ç°æ–°æ–‡ç« : {article_id} (>{max_article_id})ï¼Œç½‘ç«™æœ‰æ›´æ–°ï¼")
    # æ–°æ–‡ç« åº”è¯¥çˆ¬å–ï¼Œä¸è·³è¿‡

# æƒ…å†µ2: ä¸­é—´èŒƒå›´ï¼ˆmin_article_id <= ID <= max_article_idï¼‰- å·²çˆ¬å–ï¼Œè·³è¿‡
elif min_id_int <= article_id_int <= max_id_int:
    logger.debug(f"â­ï¸  è·³è¿‡ä¸­é—´èŒƒå›´æ–‡ç« : {article_id} ({min_article_id} <= {article_id} <= {max_article_id})")
    continue

# æƒ…å†µ3: æ›´æ—§çš„æ–‡ç« ï¼ˆID < min_article_idï¼‰- æœªçˆ¬å–ï¼Œåº”è¯¥ç»§ç»­çˆ¬å–
# ä¸è·³è¿‡ï¼Œç»§ç»­å¤„ç†
```

**ä¼˜ç‚¹**ï¼š
- âœ… å¿«é€Ÿï¼ŒO(1) åˆ¤æ–­
- âœ… é€‚ç”¨äºæ•°å­—å‹ article_id
- âœ… **æ”¯æŒæ£€æµ‹æ–°æ–‡ç« **ï¼šå¦‚æœç½‘ç«™æœ‰æ–°æ–‡ç« å‘å¸ƒï¼ˆID > max_article_idï¼‰ï¼Œä¼šè‡ªåŠ¨æ£€æµ‹å¹¶çˆ¬å–
- âœ… **æ™ºèƒ½è·³è¿‡ä¸­é—´èŒƒå›´**ï¼šè·³è¿‡ min_article_id ~ max_article_id ä¹‹é—´çš„æ–‡ç« ï¼ˆå·²çˆ¬å–èŒƒå›´ï¼‰

**ç¼ºç‚¹**ï¼š
- âš ï¸ éœ€è¦ article_id æ˜¯æ•°å­—

### æ¢å¤æµç¨‹

```
1. åŠ è½½æ£€æŸ¥ç‚¹
   â†’ seen_article_ids = {15503, 15502, ..., 15450}
   â†’ min_article_id = "15450"
   â†’ max_article_id = "15503"
   â†’ start_page = 6

2. ä»ç¬¬1é¡µå¼€å§‹çˆ¬å–ï¼ˆå€’åºæ’åˆ—ï¼Œç¬¬ä¸€é¡µæ˜¯æœ€æ–°çš„ï¼‰
   â†’ å‘ç°æ–‡ç« : 15510, 15509, 15508, 15503, 15502, ...

3. å»é‡åˆ¤æ–­
   â†’ article_id = "15510"
      - æ£€æŸ¥: "15510" > max_article_id("15503")? âœ… æ˜¯
      - ç»“è®º: ğŸ†• æ–°æ–‡ç« ï¼ç½‘ç«™æœ‰æ›´æ–° â†’ çˆ¬å–
   
   â†’ article_id = "15503"
      - æ£€æŸ¥: "15503" in seen_article_ids? âœ… æ˜¯ â†’ è·³è¿‡
   
   â†’ article_id = "15502"
      - æ£€æŸ¥: "15502" in seen_article_ids? âœ… æ˜¯ â†’ è·³è¿‡
   
   â†’ article_id = "15470"
      - æ£€æŸ¥: "15470" in seen_article_ids? âŒ å¦
      - æ£€æŸ¥: min_article_id("15450") <= "15470" <= max_article_id("15503")? âœ… æ˜¯
      - ç»“è®º: ä¸­é—´èŒƒå›´æ–‡ç« ï¼ˆå·²çˆ¬å–ï¼‰â†’ è·³è¿‡
   
   â†’ article_id = "15447"
      - æ£€æŸ¥: "15447" in seen_article_ids? âŒ å¦
      - æ£€æŸ¥: "15447" < min_article_id("15450")? âœ… æ˜¯
      - ç»“è®º: æ›´æ—§çš„æ–‡ç« ï¼ˆæœªçˆ¬å–ï¼‰â†’ çˆ¬å–

4. ä¿å­˜æ£€æŸ¥ç‚¹
   â†’ æ›´æ–° seen_article_idsï¼ˆåŒ…å«æ–°æ–‡ç« å’Œæ—§æ–‡ç« ï¼‰
   â†’ æ›´æ–° max_article_id = "15510"ï¼ˆæ–°æ–‡ç« ï¼‰
   â†’ æ›´æ–° min_article_id = "15447"ï¼ˆæ›´æ—§çš„æ–‡ç« ï¼‰
```

---

## ğŸ“Š é’ˆå¯¹ sxd.xd.com çš„å·¥ä½œæµç¨‹

### åœºæ™¯ï¼šå€’åºæ’åˆ—çš„æ–‡ç« 

**æ–‡ç« æ’åˆ—**ï¼š
```
ç¬¬1é¡µ: 15503, 15502, 15501, 15500, 15499 (æœ€æ–°ï¼ŒIDæœ€å¤§)
ç¬¬2é¡µ: 15470, 15469, 15468, 15467, 15466
ç¬¬3é¡µ: 15450, 15449, 15448, 15447, 15446 (è¾ƒæ—§ï¼ŒIDè¾ƒå°)
```

### ç¬¬ä¸€æ¬¡è¿è¡Œï¼ˆçˆ¬å–3é¡µåä¸­æ–­ï¼‰

```
1. çˆ¬å–ç¬¬1é¡µ
   â†’ å‘ç°: 15503, 15502, 15501, 15500, 15499
   â†’ seen_article_ids = {15503, 15502, 15501, 15500, 15499}
   â†’ min_article_id = "15499"
   â†’ max_article_id = "15503"
   â†’ ä¿å­˜æ£€æŸ¥ç‚¹: current_page = 2

2. çˆ¬å–ç¬¬2é¡µ
   â†’ å‘ç°: 15470, 15469, 15468, 15467, 15466
   â†’ seen_article_ids = {15503, ..., 15466}
   â†’ min_article_id = "15466"
   â†’ ä¿å­˜æ£€æŸ¥ç‚¹: current_page = 3

3. çˆ¬å–ç¬¬3é¡µ
   â†’ å‘ç°: 15450, 15449, 15448, 15447, 15446
   â†’ seen_article_ids = {15503, ..., 15446}
   â†’ min_article_id = "15446"
   â†’ ä¿å­˜æ£€æŸ¥ç‚¹: current_page = 4

4. ä¸­æ–­
```

### ç¬¬äºŒæ¬¡è¿è¡Œï¼ˆä»æ£€æŸ¥ç‚¹æ¢å¤ï¼Œç½‘ç«™æœ‰æ–°æ–‡ç« ï¼‰

```
1. åŠ è½½æ£€æŸ¥ç‚¹
   â†’ current_page = 4
   â†’ seen_article_ids = {15503, ..., 15446}
   â†’ min_article_id = "15446"
   â†’ max_article_id = "15503"

2. ä»ç¬¬1é¡µå¼€å§‹çˆ¬å–ï¼ˆå€’åºæ’åˆ—ï¼Œç¬¬ä¸€é¡µæ˜¯æœ€æ–°çš„ï¼‰
   â†’ å‘ç°: 15510, 15509, 15508, 15503, 15502, ...

3. å»é‡åˆ¤æ–­ï¼ˆæ–°æ–‡ç« æ£€æµ‹ï¼‰
   â†’ article_id = "15510"
      - æ£€æŸ¥: "15510" > max_article_id("15503")? âœ… æ˜¯
      - ç»“è®º: ğŸ†• æ–°æ–‡ç« ï¼ç½‘ç«™æœ‰æ›´æ–° â†’ çˆ¬å–
      - è¾“å‡º: "ğŸ†• å‘ç°æ–°æ–‡ç« : 15510 (>15503)ï¼Œç½‘ç«™æœ‰æ›´æ–°ï¼"
   
   â†’ article_id = "15509"
      - æ£€æŸ¥: "15509" > max_article_id("15503")? âœ… æ˜¯
      - ç»“è®º: ğŸ†• æ–°æ–‡ç«  â†’ çˆ¬å–
   
   â†’ article_id = "15503"
      - æ£€æŸ¥: "15503" in seen_article_ids? âœ… æ˜¯
      - ç»“è®º: å·²çˆ¬å– â†’ è·³è¿‡
   
   â†’ article_id = "15470"
      - æ£€æŸ¥: "15470" in seen_article_ids? âŒ å¦
      - æ£€æŸ¥: min_article_id("15446") <= "15470" <= max_article_id("15503")? âœ… æ˜¯
      - ç»“è®º: ä¸­é—´èŒƒå›´æ–‡ç« ï¼ˆå·²çˆ¬å–ï¼‰â†’ è·³è¿‡
      - è¾“å‡º: "â­ï¸  è·³è¿‡ä¸­é—´èŒƒå›´æ–‡ç« : 15470 (15446 <= 15470 <= 15503)"

4. ç»§ç»­çˆ¬å–
   â†’ å‘ç°æ–°æ–‡ç« : 15510, 15509, ...ï¼ˆç½‘ç«™æ›´æ–°ï¼‰
   â†’ å‘ç°æ—§æ–‡ç« : 15440, 15439, ...ï¼ˆç»§ç»­çˆ¬å–ï¼‰
   â†’ æ›´æ–° max_article_id = "15510"ï¼ˆæ–°æ–‡ç« ï¼‰
   â†’ æ›´æ–° min_article_id = "15439"ï¼ˆæ›´æ—§çš„æ–‡ç« ï¼‰
   â†’ ä¿å­˜æ£€æŸ¥ç‚¹
```

---

## ğŸ¯ å…³é”®ç‚¹è¯´æ˜

### ä¸ºä»€ä¹ˆéœ€è¦ä¸‰é‡å»é‡ï¼Ÿ

1. **é›†åˆå»é‡ï¼ˆç²¾ç¡®ï¼‰**
   - é€‚ç”¨äºä»»ä½•æƒ…å†µ
   - ä¸ä¼šé—æ¼å·²çˆ¬å–çš„æ–‡ç« 
   - ä½†éœ€è¦å­˜å‚¨æ‰€æœ‰ article_id

2. **IDèŒƒå›´åˆ¤æ–­ï¼ˆå¿«é€Ÿ + æ–°æ–‡ç« æ£€æµ‹ï¼‰**
   - é€‚ç”¨äºæ•°å­—å‹ article_id
   - å¿«é€Ÿåˆ¤æ–­ï¼ŒO(1)
   - **æ”¯æŒæ£€æµ‹æ–°æ–‡ç« **ï¼šå¦‚æœ `article_id > max_article_id`ï¼Œè¯´æ˜ç½‘ç«™æœ‰æ–°æ–‡ç« å‘å¸ƒ
   - **æ™ºèƒ½è·³è¿‡ä¸­é—´èŒƒå›´**ï¼šå¦‚æœ `min_article_id <= article_id <= max_article_id`ï¼Œè¯´æ˜åœ¨å·²çˆ¬å–èŒƒå›´å†…ï¼Œè·³è¿‡

3. **æ–°æ–‡ç« è‡ªåŠ¨æ£€æµ‹**
   - å¦‚æœå‘ç° `article_id > max_article_id`ï¼Œè‡ªåŠ¨è¯†åˆ«ä¸ºæ–°æ–‡ç« 
   - ç¡®ä¿ä¸ä¼šé—æ¼ç½‘ç«™æ›´æ–°

### ä¸ºä»€ä¹ˆéœ€è¦ min_article_id å’Œ max_article_idï¼Ÿ

**å€’åºæ’åˆ—çš„ç‰¹ç‚¹**ï¼š
- ç¬¬ä¸€é¡µï¼šarticle_id æœ€å¤§ï¼ˆæœ€æ–°ï¼‰
- æœ€åä¸€é¡µï¼šarticle_id æœ€å°ï¼ˆæœ€æ—§ï¼‰

**æ¢å¤æ—¶çš„åˆ¤æ–­ç­–ç•¥**ï¼š

1. **æ–°æ–‡ç« æ£€æµ‹**ï¼ˆ`article_id > max_article_id`ï¼‰
   - å¦‚æœå‘ç°æ¯” `max_article_id` æ›´å¤§çš„æ–‡ç« ï¼Œè¯´æ˜ç½‘ç«™æœ‰æ–°æ–‡ç« å‘å¸ƒ
   - åº”è¯¥çˆ¬å–è¿™äº›æ–°æ–‡ç« 
   - æ›´æ–° `max_article_id` ä¸ºæ–°æ–‡ç« çš„æœ€å¤§ID

2. **ä¸­é—´èŒƒå›´è·³è¿‡**ï¼ˆ`min_article_id <= article_id <= max_article_id`ï¼‰
   - è¿™ä¸ªèŒƒå›´å†…çš„æ–‡ç« å·²ç»åœ¨ä¹‹å‰çš„çˆ¬å–ä¸­å¤„ç†è¿‡äº†
   - åº”è¯¥è·³è¿‡ï¼Œé¿å…é‡å¤çˆ¬å–

3. **æ—§æ–‡ç« ç»§ç»­**ï¼ˆ`article_id < min_article_id`ï¼‰
   - æ¯” `min_article_id` æ›´å°çš„æ–‡ç« æ˜¯æ›´æ—§çš„æ–‡ç« 
   - åº”è¯¥ç»§ç»­çˆ¬å–è¿™äº›æ—§æ–‡ç« 
   - æ›´æ–° `min_article_id` ä¸ºæ›´å°çš„ID

### ä¸ºä»€ä¹ˆéœ€è¦ seen_article_idsï¼Ÿ

**è¡¥å……ä¿éšœ**ï¼š
- å¦‚æœæ–‡ç« é¡ºåºå‘ç”Ÿå˜åŒ–ï¼ˆå¦‚æ–°æ–‡ç« æ’å…¥ï¼‰
- å¦‚æœ article_id ä¸æ˜¯æ•°å­—
- é›†åˆå»é‡å¯ä»¥ç¡®ä¿ä¸é—æ¼

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨

```bash
# çˆ¬å–åŠ¨æ€æ–°é—»ï¼ˆè‡ªåŠ¨ä¿å­˜æ£€æŸ¥ç‚¹ï¼‰
python spider.py crawl-news "https://sxd.xd.com/" --download-images

# ä¸­æ–­åè‡ªåŠ¨æ¢å¤
python spider.py crawl-news "https://sxd.xd.com/" --download-images
# è¾“å‡º: ğŸ”„ ä»æ£€æŸ¥ç‚¹æ¢å¤: ç¬¬ 4 é¡µ
#      å·²çˆ¬å–æ–‡ç« æ•°: 15
#      æœ€å°æ–‡ç« ID: 15446
```

### æŸ¥çœ‹æ£€æŸ¥ç‚¹çŠ¶æ€

```bash
# æŸ¥çœ‹æ£€æŸ¥ç‚¹ä¿¡æ¯ï¼ˆåŒ…å« article_id ä¿¡æ¯ï¼‰
python spider.py checkpoint-status --site sxd.xd.com --board news
```

### æ‰‹åŠ¨æ§åˆ¶

```bash
# ä»ç¬¬5é¡µå¼€å§‹ï¼ˆè¦†ç›–æ£€æŸ¥ç‚¹ï¼‰
python spider.py crawl-news "https://sxd.xd.com/" --start-page 5

# ä¸ä»æ£€æŸ¥ç‚¹æ¢å¤ï¼ˆé‡æ–°å¼€å§‹ï¼‰
python spider.py crawl-news "https://sxd.xd.com/" --no-resume
```

---

## âœ… å®ç°æ€»ç»“

### å·²å®ç°

1. âœ… **æ‰©å±• CheckpointManager** - æ”¯æŒ article_id ç›¸å…³å­—æ®µ
2. âœ… **DynamicNewsCrawler é›†æˆ** - æ·»åŠ æ£€æŸ¥ç‚¹æ”¯æŒ
3. âœ… **åŸºäº article_id å»é‡** - åŒé‡ä¿éšœæœºåˆ¶
4. âœ… **CLI å‘½ä»¤æ”¯æŒ** - æ·»åŠ æ£€æŸ¥ç‚¹å‚æ•°
5. âœ… **å€’åºæ’åˆ—æ”¯æŒ** - é€šè¿‡ min_article_id åˆ¤æ–­

### å·¥ä½œåŸç†

1. **è®°å½•æ–¹å¼**: åŸºäºé¡µç  + article_id åŒé‡è®°å½•
2. **å»é‡æœºåˆ¶**: é›†åˆå»é‡ + IDèŒƒå›´åˆ¤æ–­
3. **æ¢å¤é€»è¾‘**: ä»æ£€æŸ¥ç‚¹æ¢å¤ seen_article_ids å’Œ min_article_id
4. **é€‚ç”¨åœºæ™¯**: å€’åº/æ­£åºæ’åˆ—çš„åŠ¨æ€æ–°é—»ç½‘ç«™

### ä¼˜åŠ¿

- âœ… é€‚ç”¨äºå€’åºæ’åˆ—çš„ç½‘ç«™ï¼ˆå¦‚ sxd.xd.comï¼‰
- âœ… ä¸‰é‡å»é‡ä¿éšœï¼Œä¸ä¼šé—æ¼
- âœ… è‡ªåŠ¨è·³è¿‡å·²çˆ¬å–çš„æ–‡ç« ï¼ˆä¸­é—´èŒƒå›´ï¼‰
- âœ… **è‡ªåŠ¨æ£€æµ‹æ–°æ–‡ç« **ï¼šå¦‚æœç½‘ç«™æœ‰æ–°æ–‡ç« å‘å¸ƒï¼Œä¼šè‡ªåŠ¨è¯†åˆ«å¹¶çˆ¬å–
- âœ… **æ™ºèƒ½è·³è¿‡ä¸­é—´èŒƒå›´**ï¼šè·³è¿‡ min_article_id ~ max_article_id ä¹‹é—´çš„æ–‡ç« 
- âœ… æ”¯æŒæ–‡ç« é¡ºåºå˜åŒ–

---

## ğŸš€ ä¸‹ä¸€æ­¥

åŠŸèƒ½å·²å®ç°ï¼Œå¯ä»¥æµ‹è¯•ä½¿ç”¨ï¼

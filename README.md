# BBSå›¾ç‰‡çˆ¬è™«é¡¹ç›®

ä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„BBSè®ºå›å›¾ç‰‡çˆ¬è™«ç³»ç»Ÿï¼Œæ”¯æŒè‡ªåŠ¨åŒ–çˆ¬å–ã€å›¾ç‰‡å»é‡ã€æ•°æ®å­˜å‚¨ç­‰åŠŸèƒ½ã€‚

## ğŸ“š æ–‡æ¡£å¯¼èˆª

### ğŸ—ï¸ æ¶æ„ä¸å¼€å‘
- **[ARCHITECTURE.md](ARCHITECTURE.md)** - ç³»ç»Ÿæ¶æ„è®¾è®¡æ–‡æ¡£ï¼ˆå¿…è¯»ï¼‰
- **[DEVELOPMENT_PROCESS.md](DEVELOPMENT_PROCESS.md)** - å¼€å‘æµç¨‹è§„èŒƒï¼ˆâš ï¸ å¼ºåˆ¶æ‰§è¡Œï¼‰
- **[TEAM_ROLES.md](TEAM_ROLES.md)** - å›¢é˜Ÿè§’è‰²å®šä¹‰
- **[SKILLS.md](SKILLS.md)** - æŠ€æœ¯æ ˆä¸æŠ€èƒ½æ¸…å•

### ğŸ“– ä½¿ç”¨æŒ‡å—
- **[QUICKSTART.md](QUICKSTART.md)** - å¿«é€Ÿå…¥é—¨æŒ‡å—
- **[SETUP_GUIDE.md](SETUP_GUIDE.md)** - ç¯å¢ƒé…ç½®æŒ‡å—
- **[XINDONG_README.md](XINDONG_README.md)** - å¿ƒåŠ¨è®ºå›ä¸“ç”¨è¯´æ˜

### âš ï¸ é‡è¦æç¤º
> **æ‰€æœ‰ä»£ç å˜æ›´å¿…é¡»éµå¾ªä¸¥æ ¼æµç¨‹**ï¼š  
> 1ï¸âƒ£ å…ˆæ›´æ–°è®¾è®¡æ–‡æ¡£ â†’ 2ï¸âƒ£ è®¾è®¡è¯„å®¡ â†’ 3ï¸âƒ£ ç¼–å†™ä»£ç  â†’ 4ï¸âƒ£ ä»£ç å®¡æŸ¥ â†’ 5ï¸âƒ£ æµ‹è¯•éªŒè¯  
> è¯¦è§ [å¼€å‘æµç¨‹è§„èŒƒ](DEVELOPMENT_PROCESS.md)

---

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ¯ çˆ¬å–åŠŸèƒ½
- **å¤šæ¿å—æ”¯æŒ** - æ”¯æŒçˆ¬å–å¤šä¸ªè®ºå›æ¿å—
- **è‡ªåŠ¨ç¿»é¡µ** - è‡ªåŠ¨è¯†åˆ«å¹¶çˆ¬å–åˆ†é¡µå†…å®¹
- **å›¾ç‰‡æå–** - æ™ºèƒ½æå–å¸–å­ä¸­çš„æ‰€æœ‰å›¾ç‰‡
- **å…ƒæ•°æ®æå–** - è‡ªåŠ¨æå–ä½œè€…ã€æ—¶é—´ã€æµè§ˆæ•°ç­‰ä¿¡æ¯

### ğŸ›¡ï¸ åçˆ¬è™«æœºåˆ¶
- **User-Agentè½®æ¢** - éšæœºåˆ‡æ¢æµè§ˆå™¨UA
- **è¯·æ±‚å»¶è¿Ÿ** - å¯é…ç½®çš„è¯·æ±‚é—´éš”
- **ä»£ç†æ”¯æŒ** - æ”¯æŒä»£ç†æ± è½®æ¢
- **Cookieç®¡ç†** - æ”¯æŒç™»å½•çŠ¶æ€ä¿æŒ

### ğŸ–¼ï¸ å›¾ç‰‡å¤„ç†
- **æ™ºèƒ½è¿‡æ»¤** - æŒ‰å°ºå¯¸ã€å¤§å°ã€æ ¼å¼è¿‡æ»¤å›¾ç‰‡
- **å»é‡åŠŸèƒ½** - åŸºäºURLå’Œæ–‡ä»¶å†…å®¹çš„åŒé‡å»é‡
- **ç›¸ä¼¼æ£€æµ‹** - ä½¿ç”¨æ„ŸçŸ¥å“ˆå¸Œæ£€æµ‹ç›¸ä¼¼å›¾ç‰‡
- **æ ¼å¼è½¬æ¢** - å¯é€‰çš„å›¾ç‰‡å‹ç¼©å’Œæ ¼å¼è½¬æ¢
- **å‘½åè§„èŒƒ** - å¯è‡ªå®šä¹‰çš„æ–‡ä»¶å‘½åè§„åˆ™

### ğŸ’¾ æ•°æ®å­˜å‚¨
- **MongoDB** - å­˜å‚¨å¸–å­å…ƒæ•°æ®å’Œçˆ¬å–è®°å½•
- **Redis** - ä»»åŠ¡é˜Ÿåˆ—å’ŒURLå»é‡
- **æ–‡ä»¶ç³»ç»Ÿ** - æœ¬åœ°å›¾ç‰‡å­˜å‚¨

### ğŸ“Š ç›‘æ§ç»Ÿè®¡
- **å®æ—¶ç»Ÿè®¡** - çˆ¬å–æ•°é‡ã€æˆåŠŸç‡å®æ—¶ç›‘æ§
- **æ—¥å¿—è®°å½•** - å®Œæ•´çš„æ—¥å¿—è®°å½•å’Œè½®è½¬
- **è¿›åº¦æ˜¾ç¤º** - å‹å¥½çš„è¿›åº¦æ¡æ˜¾ç¤º

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
python -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ–
venv\Scripts\activate  # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 2. é…ç½®ç¯å¢ƒ

```bash
# å¤åˆ¶é…ç½®æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
vim .env
```

ä¸»è¦é…ç½®é¡¹ï¼š

```env
# BBSè®ºå›åœ°å€
BBS_BASE_URL=https://your-bbs-site.com

# çˆ¬è™«å‚æ•°
MAX_CONCURRENT_REQUESTS=5  # å¹¶å‘è¯·æ±‚æ•°
DOWNLOAD_DELAY=1           # è¯·æ±‚å»¶è¿Ÿï¼ˆç§’ï¼‰

# æ•°æ®åº“ï¼ˆå¯é€‰ï¼‰
MONGODB_URI=mongodb://localhost:27017/
REDIS_HOST=localhost
```

### 3. ä¿®æ”¹çˆ¬è™«ä»£ç 

ç¼–è¾‘ `bbs_spider.py` çš„ `main()` å‡½æ•°ï¼š

```python
async def main():
    async with BBSSpider() as spider:
        # æ–¹å¼1ï¼šçˆ¬å–æ•´ä¸ªæ¿å—
        await spider.crawl_board(
            board_url="https://example.com/forum/æ¿å—ID",
            board_name="å›¾ç‰‡æ¿å—",
            max_pages=10  # çˆ¬å–å‰10é¡µ
        )
        
        # æ–¹å¼2ï¼šçˆ¬å–æŒ‡å®šå¸–å­
        thread_urls = [
            "https://example.com/thread/12345",
            "https://example.com/thread/67890",
        ]
        await spider.crawl_threads_from_list(thread_urls)
```

### 4. é…ç½®é€‰æ‹©å™¨

æ ¹æ®ç›®æ ‡BBSçš„HTMLç»“æ„ï¼Œä¿®æ”¹ `config.py` ä¸­çš„é€‰æ‹©å™¨ï¼š

```python
class BBSConfig(BaseModel):
    # å¸–å­åˆ—è¡¨é€‰æ‹©å™¨ï¼ˆCSSé€‰æ‹©å™¨ï¼‰
    thread_list_selector: str = "div.thread-item"
    thread_link_selector: str = "a.thread-link"
    
    # å›¾ç‰‡é€‰æ‹©å™¨
    image_selector: str = "img.post-image, img[src*='jpg']"
    
    # ä¸‹ä¸€é¡µé€‰æ‹©å™¨
    next_page_selector: str = "a.next-page"
```

### 5. è¿è¡Œçˆ¬è™«

```bash
python bbs_spider.py
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
spider/
â”œâ”€â”€ bbs_spider.py          # ä¸»çˆ¬è™«ç¨‹åº
â”œâ”€â”€ config.py              # é…ç½®ç®¡ç†
â”œâ”€â”€ requirements.txt       # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ .env                   # ç¯å¢ƒå˜é‡é…ç½®
â”œâ”€â”€ core/                  # æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ downloader.py      # å›¾ç‰‡ä¸‹è½½å™¨
â”‚   â”œâ”€â”€ parser.py          # é¡µé¢è§£æå™¨
â”‚   â”œâ”€â”€ storage.py         # æ•°æ®å­˜å‚¨
â”‚   â””â”€â”€ deduplicator.py    # å›¾ç‰‡å»é‡
â”œâ”€â”€ downloads/             # å›¾ç‰‡ä¸‹è½½ç›®å½•
â”‚   â””â”€â”€ [æ¿å—å]/
â”‚       â””â”€â”€ [å¸–å­ID]/
â”‚           â””â”€â”€ *.jpg
â””â”€â”€ logs/                  # æ—¥å¿—ç›®å½•
    â””â”€â”€ bbs_spider.log
```

## âš™ï¸ é«˜çº§é…ç½®

### å›¾ç‰‡è¿‡æ»¤é…ç½®

åœ¨ `config.py` ä¸­çš„ `ImageConfig` ç±»ï¼š

```python
class ImageConfig(BaseModel):
    # å›¾ç‰‡å°ºå¯¸è¿‡æ»¤
    min_width: int = 200      # æœ€å°å®½åº¦
    min_height: int = 200     # æœ€å°é«˜åº¦
    min_size: int = 10240     # æœ€å°æ–‡ä»¶å¤§å°ï¼ˆ10KBï¼‰
    max_size: int = 20971520  # æœ€å¤§æ–‡ä»¶å¤§å°ï¼ˆ20MBï¼‰
    
    # å…è®¸çš„æ ¼å¼
    allowed_formats: List[str] = ["jpg", "jpeg", "png", "gif", "webp"]
    
    # å›¾ç‰‡å¤„ç†
    enable_deduplication: bool = True  # å¯ç”¨å»é‡
    compress_images: bool = False      # å‹ç¼©å›¾ç‰‡
    convert_to_jpg: bool = False       # è½¬æ¢ä¸ºJPG
    quality: int = 85                  # å‹ç¼©è´¨é‡
```

### å¹¶å‘æ§åˆ¶

```python
class CrawlerConfig(BaseModel):
    max_concurrent_requests: int = 5   # æœ€å¤§å¹¶å‘æ•°
    download_delay: float = 1.0        # è¯·æ±‚å»¶è¿Ÿ
    request_timeout: int = 30          # è¶…æ—¶æ—¶é—´
    max_retries: int = 3               # æœ€å¤§é‡è¯•æ¬¡æ•°
```

### é€‰æ‹©å™¨é…ç½®ç¤ºä¾‹

ä¸åŒBBSè®ºå›çš„HTMLç»“æ„ä¸åŒï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´é€‰æ‹©å™¨ï¼š

**ç¤ºä¾‹1ï¼šDiscuzè®ºå›**
```python
thread_list_selector = "tbody[id^='normalthread']"
thread_link_selector = "a.s.xst"
image_selector = "img.zoom, img[file]"
next_page_selector = "a.nxt"
```

**ç¤ºä¾‹2ï¼šphpBBè®ºå›**
```python
thread_list_selector = "li.row"
thread_link_selector = "a.topictitle"
image_selector = "dl.attachbox img, div.content img"
next_page_selector = "a.next"
```

**ç¤ºä¾‹3ï¼šè‡ªå®šä¹‰è®ºå›**
```python
# ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰æŸ¥çœ‹HTMLç»“æ„
# é€‰æ‹©åˆé€‚çš„CSSé€‰æ‹©å™¨
thread_list_selector = "div.topic-item"
thread_link_selector = "h2 a"
image_selector = "div.post-content img"
next_page_selector = "a[rel='next']"
```

## ğŸ“Š æ•°æ®å­˜å‚¨

### MongoDBé›†åˆç»“æ„

**threadsé›†åˆ**ï¼ˆå¸–å­æ•°æ®ï¼‰ï¼š
```json
{
    "thread_id": "12345",
    "title": "å¸–å­æ ‡é¢˜",
    "url": "https://example.com/thread/12345",
    "board": "å›¾ç‰‡æ¿å—",
    "images": ["url1", "url2"],
    "metadata": {
        "author": "ä½œè€…å",
        "post_time": "2024-01-01",
        "views": 1000,
        "replies": 50
    },
    "image_count": 10,
    "created_at": "2024-01-01T12:00:00",
    "updated_at": "2024-01-01T12:00:00"
}
```

**imagesé›†åˆ**ï¼ˆå›¾ç‰‡è®°å½•ï¼‰ï¼š
```json
{
    "url": "https://example.com/image.jpg",
    "save_path": "/downloads/board/thread_id/image_001.jpg",
    "file_size": 102400,
    "metadata": {
        "board": "å›¾ç‰‡æ¿å—",
        "thread_id": "12345",
        "thread_url": "https://example.com/thread/12345"
    },
    "success": true,
    "created_at": "2024-01-01T12:00:00"
}
```

## ğŸ”§ æŠ€æœ¯æ ˆ

- **Python 3.8+**
- **aiohttp** - å¼‚æ­¥HTTPå®¢æˆ·ç«¯
- **BeautifulSoup4** - HTMLè§£æ
- **Pillow** - å›¾ç‰‡å¤„ç†
- **imagehash** - å›¾ç‰‡å»é‡
- **MongoDB** - æ•°æ®å­˜å‚¨
- **Redis** - ä»»åŠ¡é˜Ÿåˆ—
- **loguru** - æ—¥å¿—è®°å½•

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šçˆ¬å–å•ä¸ªæ¿å—

```python
async with BBSSpider() as spider:
    await spider.crawl_board(
        board_url="https://example.com/forum/photo",
        board_name="æ‘„å½±æ¿å—",
        max_pages=20
    )
```

### ç¤ºä¾‹2ï¼šçˆ¬å–å¤šä¸ªå¸–å­

```python
thread_urls = [
    "https://example.com/thread/1",
    "https://example.com/thread/2",
    "https://example.com/thread/3",
]

async with BBSSpider() as spider:
    await spider.crawl_threads_from_list(thread_urls)
```

### ç¤ºä¾‹3ï¼šè·å–ç»Ÿè®¡ä¿¡æ¯

```python
async with BBSSpider() as spider:
    # ... æ‰§è¡Œçˆ¬å– ...
    
    stats = spider.get_statistics()
    print(f"çˆ¬å–å¸–å­æ•°: {stats['threads_crawled']}")
    print(f"å‘ç°å›¾ç‰‡æ•°: {stats['images_found']}")
    print(f"ä¸‹è½½æˆåŠŸæ•°: {stats['images_downloaded']}")
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **éµå®ˆrobots.txt** - è¯·å°Šé‡ç½‘ç«™çš„çˆ¬è™«åè®®
2. **åˆç†è®¾ç½®å»¶è¿Ÿ** - é¿å…å¯¹æœåŠ¡å™¨é€ æˆå‹åŠ›
3. **ç‰ˆæƒæ„è¯†** - ä¸‹è½½çš„å›¾ç‰‡ä»…ä¾›å­¦ä¹ ç ”ç©¶ä½¿ç”¨
4. **ç™»å½•çŠ¶æ€** - æŸäº›è®ºå›éœ€è¦ç™»å½•ï¼Œè¯·é…ç½®ç”¨æˆ·åå¯†ç 
5. **é€‰æ‹©å™¨é€‚é…** - ä¸åŒè®ºå›éœ€è¦è°ƒæ•´CSSé€‰æ‹©å™¨
6. **æ•°æ®åº“å¯é€‰** - ä¸é…ç½®æ•°æ®åº“ä¹Ÿå¯è¿è¡Œï¼Œä»…ä¿å­˜æœ¬åœ°æ–‡ä»¶

## ğŸ› æ•…éšœæ’æŸ¥

### 1. æ— æ³•è¿æ¥æ•°æ®åº“

```bash
# æ£€æŸ¥MongoDBæ˜¯å¦è¿è¡Œ
sudo systemctl status mongodb

# æ£€æŸ¥Redisæ˜¯å¦è¿è¡Œ
redis-cli ping
```

æ•°æ®åº“æ˜¯å¯é€‰çš„ï¼Œå¦‚æœä¸éœ€è¦å¯ä»¥æ³¨é‡Šæ‰ç›¸å…³ä»£ç ã€‚

### 2. å›¾ç‰‡ä¸‹è½½å¤±è´¥

- æ£€æŸ¥ç½‘ç»œè¿æ¥
- æ£€æŸ¥å›¾ç‰‡URLæ˜¯å¦æœ‰æ•ˆ
- å¢åŠ é‡è¯•æ¬¡æ•°å’Œè¶…æ—¶æ—¶é—´
- æ£€æŸ¥æ˜¯å¦éœ€è¦ç™»å½•

### 3. é€‰æ‹©å™¨æ— æ³•åŒ¹é…

- ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·æ£€æŸ¥HTMLç»“æ„
- éªŒè¯CSSé€‰æ‹©å™¨æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥é¡µé¢æ˜¯å¦ä¸ºåŠ¨æ€åŠ è½½ï¼ˆéœ€ä½¿ç”¨Selenium/Playwrightï¼‰

### 4. å†…å­˜å ç”¨è¿‡é«˜

- å‡å°‘å¹¶å‘æ•° `MAX_CONCURRENT_REQUESTS`
- å¯ç”¨å›¾ç‰‡å‹ç¼© `compress_images=True`
- æ¸…ç†é‡å¤æ–‡ä»¶

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·åˆ›å»ºIssueã€‚
